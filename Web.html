<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C·∫°nh tranh trong N·ªÅn kinh t·∫ø s·ªë (v·ªõi Gemini AI)</title>
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: ·ª®ng d·ª•ng ƒë∆∞·ª£c thi·∫øt k·∫ø d·∫°ng SPA v·ªõi 1 header v√† 1 thanh ƒëi·ªÅu h∆∞·ªõng c·ªë ƒë·ªãnh (sticky). Thanh ƒëi·ªÅu h∆∞·ªõng cho ph√©p nh·∫£y (scroll) ƒë·∫øn 5 ph·∫ßn n·ªôi dung ch√≠nh. Ngay b√™n d∆∞·ªõi l√† 1 thanh l·ªçc t∆∞∆°ng t√°c (filter) theo c√¥ng ty (Grab, Shopee, TikTok) v√† 1 bi·ªÉu ƒë·ªì t·ªïng quan. Ph·∫ßn n·ªôi dung ch√≠nh tr√¨nh b√†y 5 bi·ªÉu hi·ªán c·∫°nh tranh, m·ªói bi·ªÉu hi·ªán ƒë∆∞·ª£c chia th√†nh 3 th·∫ª (L√Ω thuy·∫øt, V√≠ d·ª•, Li√™n h·ªá M√°c-L√™nin) n·∫±m c·∫°nh nhau tr√™n desktop (d·∫°ng grid) ƒë·ªÉ d·ªÖ so s√°nh. T∆∞∆°ng t√°c c·ªët l√µi: 1) Nh·∫•p v√†o ƒëi·ªÅu h∆∞·ªõng ƒë·ªÉ cu·ªôn ƒë·∫øn ph·∫ßn. 2) Nh·∫•p v√†o b·ªô l·ªçc (v√≠ d·ª•: "Grab") s·∫Ω l√†m n·ªïi b·∫≠t (highlight) t·∫•t c·∫£ c√°c th·∫ª "V√≠ d·ª•" c√≥ li√™n quan ƒë·∫øn Grab v√† l√†m m·ªù (dim) c√°c th·∫ª kh√¥ng li√™n quan, ƒë·ªìng th·ªùi c·∫≠p nh·∫≠t c√°c th·∫ª "L√Ω thuy·∫øt" v√† "Li√™n h·ªá" t∆∞∆°ng ·ª©ng. 3) M·ªôt bi·ªÉu ƒë·ªì thanh ngang x·∫øp ch·ªìng t·ªïng quan cho th·∫•y c√°c c√¥ng ty s·ª≠ d·ª•ng chi·∫øn l∆∞·ª£c n√†o. 4) T√≠ch h·ª£p Gemini: N√∫t "Gi·∫£i th√≠ch s√¢u h∆°n" trong th·∫ª "Li√™n h·ªá M√°c-L√™nin" g·ªçi API Gemini text-gen ƒë·ªÉ ph√¢n t√≠ch. 5) N√∫t "Nghe" g·ªçi API Gemini TTS ƒë·ªÉ ƒë·ªçc k·∫øt qu·∫£. -->
    <!-- Visualization & Content Choices:
    1.  Overview Chart: Report Info -> C√°c c√¥ng ty (Grab, Shopee, TikTok) v√† 5 chi·∫øn l∆∞·ª£c. Goal -> So s√°nh, T·ªïng quan. Viz -> Bi·ªÉu ƒë·ªì thanh ngang x·∫øp ch·ªìng (Horizontal Stacked Bar Chart) b·∫±ng Chart.js. Interaction -> Nh·∫•p v√†o m·ªôt thanh (v√≠ d·ª•: "Grab") s·∫Ω k√≠ch ho·∫°t b·ªô l·ªçc cho c√¥ng ty ƒë√≥. Justification -> Cung c·∫•p c√°i nh√¨n t·ªïng quan ngay l·∫≠p-t·ª©c v·ªÅ "ai ƒëang l√†m g√¨".
    2.  Content Sections (5): Report Info -> 5 bi·ªÉu hi·ªán c·∫°nh tranh. Goal -> T·ªï ch·ª©c, So s√°nh. Viz/Presentation -> B·ªë c·ª•c l∆∞·ªõi 3 c·ªôt (HTML/Tailwind) cho "L√Ω thuy·∫øt", "V√≠ d·ª•", "Li√™n h·ªá". Interaction -> C√°c th·∫ª n√†y ph·∫£n ·ª©ng v·ªõi b·ªô l·ªçc c·ªßa c√¥ng ty (highlight/dim) b·∫±ng JS. Justification -> C·∫•u tr√∫c n√†y tr·ª±c quan h√≥a m·ªëi li√™n h·ªá gi·ªØa l√Ω thuy·∫øt, th·ª±c ti·ªÖn v√† ph√¢n t√≠ch h·ªçc thu·∫≠t, l√† c·ªët l√µi c·ªßa b√°o c√°o.
    3.  Gemini Explain: Report Info -> L√Ω thuy·∫øt + Li√™n h·ªá M-L. Goal -> Ph√¢n t√≠ch, Gi·∫£i th√≠ch. Viz -> Modal. Interaction -> N√∫t b·∫•m. Justification -> Th√™m chi·ªÅu s√¢u ph√¢n t√≠ch AI.
    4.  Gemini TTS: Report Info -> VƒÉn b·∫£n do AI t·∫°o. Goal -> H·ªó tr·ª£ ti·∫øp c·∫≠n, h·ªçc t·∫≠p. Viz -> N√∫t b·∫•m + Audio. Interaction -> N√∫t b·∫•m. Justification -> Cung c·∫•p ph∆∞∆°ng th·ª©c ti√™u th·ª• n·ªôi dung thay th·∫ø.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #F7F3E8; /* Warm Neutral - Light beige background */
            color: #3D3B30; /* Warm Neutral - Dark brown text */
            font-family: "Inter", sans-serif;
        }
        
        /* --- Hi·ªáu ·ª©ng Gooey (Gi·ªçt n∆∞·ªõc) --- */
        svg.gooey-filter {
            position: absolute;
            width: 0;
            height: 0;
        }

        #gooey-background {
            position: fixed;
            inset: 0;
            z-index: -10;
            overflow: hidden;
            background: #F7F3E8;
            filter: url('#gooey-effect'); /* √Åp d·ª•ng b·ªô l·ªçc SVG */
        }

        .blob {
            position: absolute;
            border-radius: 50%;
            opacity: 0.6;
            animation: moveBlob 20s infinite ease-in-out;
        }

        .blob:nth-child(1) {
            width: 250px; height: 250px;
            top: 10vh; left: 10vw;
            background-color: #FCD34D; /* amber-300 */
        }
        .blob:nth-child(2) {
            width: 350px; height: 350px;
            top: 50vh; left: 60vw;
            background-color: #7DD3FC; /* sky-300 */
            animation-duration: 25s;
            animation-delay: -5s;
        }
        .blob:nth-child(3) {
            width: 300px; height: 300px;
            top: 60vh; left: 5vw;
            background-color: #FDBA74; /* orange-300 */
            animation-duration: 18s;
            animation-delay: -10s;
        }

        @keyframes moveBlob {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(30vw, 40vh) scale(1.2); }
            50% { transform: translate(-20vw, 10vh) scale(0.8); }
            75% { transform: translate(10vw, -30vh) scale(1.1); }
        }
        /* --- H·∫øt Hi·ªáu ·ª©ng Gooey --- */


        header, nav {
            background-color: rgba(255, 255, 255, 0.7); /* Th√™m ƒë·ªô trong su·ªët */
            backdrop-filter: blur(12px); /* Hi·ªáu ·ª©ng k√≠nh m·ªù */
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(200, 200, 200, 0.2);
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }

        .nav-link {
            @apply px-3 py-2 rounded-lg text-sm font-medium text-gray-700 hover:bg-amber-100 transition-all duration-300;
        }
        .nav-link.active {
            @apply bg-amber-700 text-white font-semibold shadow-md;
        }
        
        .filter-btn {
            @apply px-4 py-2 rounded-full text-sm font-medium border-2 border-amber-600 text-amber-700 hover:bg-amber-600 hover:text-white hover:shadow-lg hover:scale-105 transition-all duration-300;
        }
        .filter-btn.active {
            @apply bg-amber-600 text-white shadow-md;
        }
        
        /* --- N√¢ng c·∫•p Th·∫ª N·ªôi dung (Glassmorphism) --- */
        .content-card {
            background-color: rgba(255, 255, 255, 0.75); /* K√≠nh m·ªù */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            @apply p-6 rounded-2xl shadow-xl transition-all duration-300 ease-in-out flex flex-col border border-white/50;
        }
        
        .content-card-body {
            @apply flex-grow;
        }
        
        .content-wrapper.dimmed .content-card {
            @apply opacity-30 blur-sm;
        }
        
        .content-wrapper.highlight .content-card {
            @apply opacity-100 ring-4 ring-amber-500 ring-offset-2 scale-105;
        }
        
        .content-card h3 {
            @apply text-xl font-bold text-amber-900 mb-3; /* B·ªè border-bottom */
        }
        
        .content-card ul {
            @apply list-disc list-inside space-y-2 text-gray-800;
        }
        
        .gemini-btn, .tts-btn {
            @apply mt-5 px-4 py-2 rounded-lg text-sm font-semibold text-white shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-300 flex items-center justify-center gap-2;
        }
        
        .gemini-btn {
            @apply bg-gradient-to-r from-amber-600 to-amber-700;
        }

        .tts-btn {
            @apply bg-gradient-to-r from-sky-600 to-sky-700 disabled:opacity-50 disabled:cursor-not-allowed;
        }
        
        #gemini-modal.hidden {
            display: none;
        }
        
        #gemini-modal {
            @apply fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm;
        }
        
        .modal-content {
            background-color: rgba(255, 255, 255, 0.9); /* K√≠nh m·ªù cho Modal */
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            @apply p-6 rounded-2xl shadow-2xl max-w-2xl w-11/12 max-h-[80vh] overflow-y-auto border border-white/60;
        }
        
        .loader {
            @apply w-8 h-8 border-4 border-amber-200 border-t-amber-600 rounded-full animate-spin;
        }
    </style>
</head>
<body class="antialiased">

    <!-- B·ªô l·ªçc SVG cho hi·ªáu ·ª©ng Gooey (Gi·ªçt n∆∞·ªõc) -->
    <svg class="gooey-filter">
        <defs>
            <filter id="gooey-effect">
                <feGaussianBlur in="SourceGraphic" stdDeviation="12" result="blur" />
                <feColorMatrix in="blur" mode="matrix" values="
                    1 0 0 0 0
                    0 1 0 0 0
                    0 0 1 0 0
                    0 0 0 18 -7" result="gooey" />
                <feBlend in="SourceGraphic" in2="gooey" />
            </filter>
        </defs>
    </svg>

    <!-- N·ªÅn Gooey (Gi·ªçt n∆∞·ªõc) -->
    <div id="gooey-background">
        <div class="blob"></div>
        <div class="blob"></div>
        <div class="blob"></div>
    </div>

    <!-- Header -->
    <header class="sticky top-0 z-50 shadow-md">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <h1 class="text-3xl font-bold text-center text-amber-900">
                C·∫°nh tranh trong N·ªÅn kinh t·∫ø s·ªë: C√°c Bi·ªÉu hi·ªán m·ªõi
            </h1>
            <p class="text-center text-gray-700 mt-1">Ph√¢n t√≠ch qua case study Grab, Shopee, v√† TikTok Shop (T√≠ch h·ª£p Gemini AI)</p>
        </div>
    </header>

    <!-- Navigation -->
    <nav id="navbar" class="sticky top-[88px] z-40 shadow-sm py-3">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-wrap items-center justify-center gap-2">
                <a href="#overview" class="nav-link active" data-section="overview">T·ªïng quan</a>
                <a href="#network-effects" class="nav-link" data-section="network-effects">Hi·ªáu ·ª©ng M·∫°ng l∆∞·ªõi</a>
                <a href="#data-competition" class="nav-link" data-section="data-competition">C·∫°nh tranh D·ªØ li·ªáu</a>
                <a href="#cash-burning" class="nav-link" data-section="cash-burning">"ƒê·ªët ti·ªÅn"</a>
                <a href="#ecosystem" class="nav-link" data-section="ecosystem">H·ªá sinh th√°i</a>
                <a href="#shoppertainment" class="nav-link" data-section="shoppertainment">Shoppertainment</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-28">

        <!-- Filter Section -->
        <section class="mb-10 p-5 bg-white/70 backdrop-blur-lg rounded-2xl shadow-lg">
            <div class="flex flex-wrap items-center justify-center gap-3">
                <span class="font-semibold text-gray-700">L·ªçc theo c√¥ng ty:</span>
                <button class="filter-btn active" data-filter="all">T·∫•t c·∫£</button>
                <button class="filter-btn" data-filter="grab">Grab</button>
                <button class="filter-btn" data-filter="shopee">Shopee</button>
                <button class="filter-btn" data-filter="tiktok">TikTok Shop</button>
            </div>
        </section>

        <!-- Overview Chart -->
        <section id="overview" class="mb-12 pt-12 -mt-12">
            <h2 class="text-3xl font-bold text-center text-amber-900 mb-6">T·ªïng quan: Ai d√πng chi·∫øn l∆∞·ª£c g√¨?</h2>
            <p class="text-center text-gray-700 mb-6 max-w-3xl mx-auto">
                Bi·ªÉu ƒë·ªì n√†y t·ªïng h·ª£p c√°c chi·∫øn l∆∞·ª£c c·∫°nh tranh ch√≠nh m√† m·ªói n·ªÅn t·∫£ng s·ª≠ d·ª•ng. B·∫°n c√≥ th·ªÉ nh·∫•p v√†o m·ªôt thanh (v√≠ d·ª•: thanh "Grab") ƒë·ªÉ l·ªçc n·ªôi dung b√™n d∆∞·ªõi v√† xem chi ti·∫øt c√°c chi·∫øn l∆∞·ª£c c·ªßa c√¥ng ty ƒë√≥.
            </p>
            <div class="chart-container p-4 bg-white/70 backdrop-blur-lg rounded-2xl shadow-lg">
                <canvas id="strategyMatrixChart"></canvas>
            </div>
        </section>

        <!-- 1. Network Effects -->
        <section id="network-effects" class="mb-12 pt-16 -mt-12">
            <h2 class="text-3xl font-bold text-amber-900 mb-8">1. Hi·ªáu ·ª©ng M·∫°ng l∆∞·ªõi</h2>
            <div class="content-wrapper grid grid-cols-1 md:grid-cols-3 gap-6" data-topic="network-effects">
                <div class="content-card" data-type="theory">
                    <h3>L√Ω thuy·∫øt</h3>
                    <div class="content-card-body">
                        <p>C·∫°nh tranh kh√¥ng c√≤n ƒë∆°n thu·∫ßn l√† gi·ªØa c√°c c√¥ng ty b√°n s·∫£n ph·∫©m, m√† l√† gi·ªØa c√°c **n·ªÅn t·∫£ng** (platform) nh·∫±m thu h√∫t c·∫£ hai ph√≠a: ng∆∞·ªùi d√πng (mua) v√† nh√† cung c·∫•p (b√°n/d·ªãch v·ª•).</p>
                        <p class="mt-2">Gi√° tr·ªã c·ªßa n·ªÅn t·∫£ng tƒÉng theo c·∫•p s·ªë nh√¢n khi c√≥ th√™m ng∆∞·ªùi d√πng (g·ªçi l√† "hi·ªáu ·ª©ng m·∫°ng l∆∞·ªõi"). N·ªÅn t·∫£ng n√†o c√≥ nhi·ªÅu ng∆∞·ªùi d√πng h∆°n s·∫Ω thu h√∫t nhi·ªÅu nh√† cung c·∫•p h∆°n, v√† ng∆∞·ª£c l·∫°i, t·∫°o ra m·ªôt v√≤ng l·∫∑p t·ª± c·ªßng c·ªë.</p>
                    </div>
                </div>
                <div class="content-card" data-company="shopee grab">
                    <h3>V√≠ d·ª• th·ª±c ti·ªÖn</h3>
                    <div class="content-card-body">
                        <ul>
                            <li><strong>Shopee:</strong> T·∫°o ra m·ªôt "ch·ª£" online. C√†ng nhi·ªÅu ng∆∞·ªùi b√°n, Shopee c√†ng c√≥ nhi·ªÅu s·∫£n ph·∫©m, gi√° r·∫ª, thu h√∫t th√™m ng∆∞·ªùi mua. C√†ng nhi·ªÅu ng∆∞·ªùi mua, Shopee c√†ng tr·ªü th√†nh k√™nh b√°n h√†ng h·∫•p d·∫´n, thu h√∫t th√™m ng∆∞·ªùi b√°n.</li>
                            <li><strong>Grab:</strong> Kh√¥ng s·ªü h·ªØu xe nh∆∞ng th·ªëng tr·ªã th·ªã tr∆∞·ªùng. H·ªç thu h√∫t nhi·ªÅu t√†i x·∫ø (gi·∫£m th·ªùi gian ch·ªù) v√† nhi·ªÅu h√†nh kh√°ch (t√†i x·∫ø c√≥ thu nh·∫≠p). Hi·ªáu ·ª©ng m·∫°ng l∆∞·ªõi n√†y khi·∫øn ƒë·ªëi th·ªß nh·ªè r·∫•t kh√≥ chen ch√¢n.</li>
                        </ul>
                    </div>
                </div>
                <div class="content-card" data-type="analysis">
                    <h3>Li√™n h·ªá M√°c-L√™nin</h3>
                    <div class="content-card-body">
                        <ul>
                            <li>Bi·ªÉu hi·ªán c·ªßa vi·ªác **t·∫≠p trung t∆∞ b·∫£n**. N·ªÅn t·∫£ng ho·∫°t ƒë·ªông nh∆∞ m·ªôt "t∆∞ b·∫£n" trung gian.</li>
                            <li>Hi·ªáu ·ª©ng m·∫°ng l∆∞·ªõi nhanh ch√≥ng d·∫´n ƒë·∫øn **ƒë·ªôc quy·ªÅn** ("chi·∫øn th·∫Øng l·∫•y t·∫•t c·∫£").</li>
                            <li>N·ªÅn t·∫£ng tr·ªü th√†nh m·ªôt "t∆∞ li·ªáu s·∫£n xu·∫•t" ki·ªÉu m·ªõi, ki·ªÉm so√°t ph∆∞∆°ng th·ª©c trao ƒë·ªïi. Ng∆∞·ªùi b√°n/t√†i x·∫ø b·ªã ph·ª• thu·ªôc v√† b·ªã n·ªÅn t·∫£ng "b√≥c l·ªôt" gi√° tr·ªã th·∫∑ng d∆∞ qua ph√≠, chi·∫øt kh·∫•u.</li>
                        </ul>
                    </div>
                    <button class="gemini-btn" data-action="explain">‚ú® Gi·∫£i th√≠ch s√¢u h∆°n</button>
                </div>
            </div>
        </section>

        <!-- 2. Data Competition -->
        <section id="data-competition" class="mb-12 pt-16 -mt-12">
            <h2 class="text-3xl font-bold text-amber-900 mb-8">2. C·∫°nh tranh b·∫±ng D·ªØ li·ªáu</h2>
            <div class="content-wrapper grid grid-cols-1 md:grid-cols-3 gap-6" data-topic="data-competition">
                <div class="content-card" data-type="theory">
                    <h3>L√Ω thuy·∫øt</h3>
                    <div class="content-card-body">
                        <p>**D·ªØ li·ªáu ng∆∞·ªùi d√πng (data)** tr·ªü th√†nh t√†i s·∫£n v√† v≈© kh√≠ c·∫°nh tranh quan tr·ªçng nh·∫•t. C√°c c√¥ng ty thu th·∫≠p, ph√¢n t√≠ch h√†nh vi ng∆∞·ªùi d√πng ƒë·ªÉ t·ªëi ∆∞u h√≥a s·∫£n ph·∫©m, c√° nh√¢n h√≥a tr·∫£i nghi·ªám, v√† nh·∫Øm m·ª•c ti√™u qu·∫£ng c√°o ch√≠nh x√°c.</p>
                    </div>
                </div>
                <div class="content-card" data-company="tiktok shopee">
                    <h3>V√≠ d·ª• th·ª±c ti·ªÖn</h3>
                    <div class="content-card-body">
                        <ul>
                            <li><strong>TikTok Shop:</strong> Hi·ªÉu r√µ b·∫°n th√≠ch xem g√¨ (thu·∫≠t to√°n), t·ª´ ƒë√≥ d·ª± ƒëo√°n b·∫°n *mu·ªën mua g√¨* v√† hi·ªÉn th·ªã s·∫£n ph·∫©m tr·ª±c ti·∫øp tr√™n video. Kh·∫£ nƒÉng "bi·∫øn ng∆∞·ªùi xem th√†nh ng∆∞·ªùi mua" v∆∞·ª£t tr·ªôi nh·ªù d·ªØ li·ªáu h√†nh vi.</li>
                            <li><strong>Shopee:</strong> Theo d√µi t·ª´ng c√∫ click, s·∫£n ph·∫©m xem... ƒë·ªÉ ƒë∆∞a ra g·ª£i √Ω "S·∫£n ph·∫©m t∆∞∆°ng t·ª±", "C√≥ th·ªÉ b·∫°n c≈©ng th√≠ch". D·ªØ li·ªáu n√†y c≈©ng ƒë∆∞·ª£c b√°n cho nh√† qu·∫£ng c√°o (Shopee Ads).</li>
                        </ul>
                    </div>
                </div>
                <div class="content-card" data-type="analysis">
                    <h3>Li√™n h·ªá M√°c-L√™nin</h3>
                    <div class="content-card-body">
                        <ul>
                            <li>N·∫øu t∆∞ b·∫£n truy·ªÅn th·ªëng c√≥ t∆∞ li·ªáu s·∫£n xu·∫•t l√† nh√† m√°y, th√¨ trong kinh t·∫ø s·ªë, **d·ªØ li·ªáu ch√≠nh l√† "t∆∞ li·ªáu s·∫£n xu·∫•t"** quan tr·ªçng.</li>
                            <li>Vi·ªác thu th·∫≠p d·ªØ li·ªáu l√† h√¨nh th·ª©c "b√≥c l·ªôt" m·ªõi. Ng∆∞·ªùi d√πng cung c·∫•p "lao ƒë·ªông" (t·∫°o ra d·ªØ li·ªáu) m√† kh√¥ng ƒë∆∞·ª£c tr·∫£ c√¥ng, trong khi n·ªÅn t·∫£ng bi·∫øn n√≥ th√†nh t∆∞ b·∫£n v√† l·ª£i nhu·∫≠n. (Kh√°i ni·ªám "Ch·ªß nghƒ©a t∆∞ b·∫£n gi√°m s√°t").</li>
                        </ul>
                    </div>
                    <button class="gemini-btn" data-action="explain">‚ú® Gi·∫£i th√≠ch s√¢u h∆°n</button>
                </div>
            </div>
        </section>
        
        <!-- 3. Cash Burning -->
        <section id="cash-burning" class="mb-12 pt-16 -mt-12">
            <h2 class="text-3xl font-bold text-amber-900 mb-8">3. C·∫°nh tranh "ƒê·ªët ti·ªÅn"</h2>
            <div class="content-wrapper grid grid-cols-1 md:grid-cols-3 gap-6" data-topic="cash-burning">
                <div class="content-card" data-type="theory">
                    <h3>L√Ω thuy·∫øt</h3>
                    <div class="content-card-body">
                        <p>C√°c c√¥ng ty n·ªÅn t·∫£ng s·ª≠ d·ª•ng ngu·ªìn v·ªën ƒë·∫ßu t∆∞ m·∫°o hi·ªÉm kh·ªïng l·ªì ƒë·ªÉ "ƒë·ªët ti·ªÅn" (cash burning) ‚Äì tung ra khuy·∫øn m√£i, tr·ª£ gi√°, mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn... H·ªç ch·∫•p nh·∫≠n l·ªó n·∫∑ng trong th·ªùi gian d√†i ƒë·ªÉ gi√†nh th·ªã ph·∫ßn v√† ti√™u di·ªát ƒë·ªëi th·ªß.</p>
                    </div>
                </div>
                <div class="content-card" data-company="grab shopee">
                    <h3>V√≠ d·ª• th·ª±c ti·ªÖn</h3>
                    <div class="content-card-body">
                        <ul>
                            <li><strong>Grab vs. Uber/Gojek:</strong> Cu·ªôc chi·∫øn "ƒë·ªët ti·ªÅn" tr·ª£ gi√° cho c·∫£ t√†i x·∫ø v√† kh√°ch h√†ng. Ai c·∫°n v·ªën tr∆∞·ªõc, ng∆∞·ªùi ƒë√≥ thua.</li>
                            <li><strong>Shopee vs. Lazada/Tiki:</strong> Cu·ªôc chi·∫øn "voucher" v√† "freeship" kh√¥ng h·ªìi k·∫øt. Shopee c√≥ ngu·ªìn v·ªën d·ªìi d√†o, s·∫µn s√†ng chi h√†ng ngh√¨n t·ª∑ ƒë·ªìng ƒë·ªÉ tr·ª£ gi√°, thu h√∫t ng∆∞·ªùi d√πng t·ª´ ƒë·ªëi th·ªß.</li>
                        </ul>
                    </div>
                </div>
                <div class="content-card" data-type="analysis">
                    <h3>Li√™n h·ªá M√°c-L√™nin</h3>
                    <div class="content-card-body">
                        <ul>
                            <li>Bi·ªÉu hi·ªán c·ªßa quy lu·∫≠t **c·∫°nh tranh gay g·∫Øt d·∫´n ƒë·∫øn t√≠ch t·ª• v√† t·∫≠p trung t∆∞ b·∫£n**.</li>
                            <li>H√¨nh th·ª©c "d√πng t∆∞ b·∫£n ƒë√® b·∫πp t∆∞ b·∫£n". C√°c "t∆∞ b·∫£n" l·ªõn r√≥t v·ªën ƒë·ªÉ m·ªôt c√¥ng ty **ti√™u di·ªát c√°c ƒë·ªëi th·ªß c·∫°nh tranh**.</li>
                            <li>Khi ƒë√£ ƒë·ªôc quy·ªÅn, c√¥ng ty s·∫Ω ng·ª´ng "ƒë·ªët ti·ªÅn" v√† b·∫Øt ƒë·∫ßu tƒÉng gi√°/ph√≠ ƒë·ªÉ thu l·ª£i nhu·∫≠n ƒë·ªôc quy·ªÅn (v√≠ d·ª•: c∆∞·ªõc Grab tƒÉng, voucher Shopee kh√≥ l·∫•y h∆°n).</li>
                        </ul>
                    </div>
                    <button class="gemini-btn" data-action="explain">‚ú® Gi·∫£i th√≠ch s√¢u h∆°n</button>
                </div>
            </div>
        </section>

        <!-- 4. Ecosystem -->
        <section id="ecosystem" class="mb-12 pt-16 -mt-12">
            <h2 class="text-3xl font-bold text-amber-900 mb-8">4. C·∫°nh tranh H·ªá sinh th√°i</h2>
            <div class="content-wrapper grid grid-cols-1 md:grid-cols-3 gap-6" data-topic="ecosystem">
                <div class="content-card" data-type="theory">
                    <h3>L√Ω thuy·∫øt</h3>
                    <div class="content-card-body">
                        <p>C·∫°nh tranh kh√¥ng ch·ªâ ·ªü m·ªôt d·ªãch v·ª•, m√† l√† x√¢y d·ª±ng m·ªôt "h·ªá sinh th√°i" kh√©p k√≠n, n∆°i ng∆∞·ªùi d√πng c√≥ th·ªÉ s·ª≠ d·ª•ng m·ªçi d·ªãch v·ª• trong c√πng m·ªôt "Si√™u ·ª©ng d·ª•ng" (Super-app). M·ª•c ti√™u l√† "kh√≥a" ng∆∞·ªùi d√πng (user lock-in) trong h·ªá sinh th√°i c·ªßa m√¨nh.</p>
                    </div>
                </div>
                <div class="content-card" data-company="grab shopee">
                    <h3>V√≠ d·ª• th·ª±c ti·ªÖn</h3>
                    <div class="content-card-body">
                        <ul>
                            <li><strong>Grab:</strong> T·ª´ g·ªçi xe, ph√°t tri·ªÉn th√†nh si√™u ·ª©ng d·ª•ng v·ªõi: GrabFood (giao ƒë·ªì ƒÉn), GrabMart (ƒëi ch·ª£), GrabExpress (giao h√†ng), v√† Moca/GrabPay (thanh to√°n).</li>
                            <li><strong>Shopee:</strong> C≈©ng ƒëang x√¢y d·ª±ng h·ªá sinh th√°i: Shopee (mua s·∫Øm), ShopeeFood/Now (giao ƒë·ªì ƒÉn), ShopeePay (v√≠ ƒëi·ªán t·ª≠).</li>
                        </ul>
                    </div>
                </div>
                <div class="content-card" data-type="analysis">
                    <h3>Li√™n h·ªá M√°c-L√™nin</h3>
                    <div class="content-card-body">
                        <ul>
                            <li>M·ªôt h√¨nh th·ª©c **ƒë·ªôc quy·ªÅn ki·ªÉu m·ªõi**. Thay v√¨ ƒë·ªôc quy·ªÅn m·ªôt s·∫£n ph·∫©m, c√°c t·∫≠p ƒëo√†n n√†y ƒë·ªôc quy·ªÅn *to√†n b·ªô chu tr√¨nh ti√™u d√πng* c·ªßa kh√°ch h√†ng.</li>
                            <li>B·∫±ng c√°ch ki·ªÉm so√°t nhi·ªÅu kh√¢u, h·ªç t·∫°o ra r√†o c·∫£n gia nh·∫≠p th·ªã tr∆∞·ªùng kh·ªïng l·ªì m√† c√°c c√¥ng ty m·ªõi kh√¥ng th·ªÉ v∆∞·ª£t qua.</li>
                        </ul>
                    </div>
                    <button class="gemini-btn" data-action="explain">‚ú® Gi·∫£i th√≠ch s√¢u h∆°n</button>
                </div>
            </div>
        </section>

        <!-- 5. Shoppertainment -->
        <section id="shoppertainment" class="mb-12 pt-16 -mt-12">
            <h2 class="text-3xl font-bold text-amber-900 mb-8">5. Shoppertainment</h2>
            <div class="content-wrapper grid grid-cols-1 md:grid-cols-3 gap-6" data-topic="shoppertainment">
                <div class="content-card" data-type="theory">
                    <h3>L√Ω thuy·∫øt</h3>
                    <div class="content-card-body">
                        <p>H√¨nh th·ª©c m·ªõi nh·∫•t, ƒë·∫∑c bi·ªát v·ªõi TikTok. C·∫°nh tranh kh√¥ng ch·ªâ l√† khi ng∆∞·ªùi d√πng *c√≥ nhu c·∫ßu* mua h√†ng (nh∆∞ l√™n Shopee t√¨m), m√† l√† *t·∫°o ra nhu c·∫ßu* ngay trong l√∫c h·ªç ƒëang gi·∫£i tr√≠.</p>
                    </div>
                </div>
                <div class="content-card" data-company="tiktok">
                    <h3>V√≠ d·ª• th·ª±c ti·ªÖn</h3>
                    <div class="content-card-body">
                        <ul>
                            <li><strong>TikTok Shop:</strong> B·∫°n ƒëang l∆∞·ªõt xem video gi·∫£i tr√≠, th·∫•y m·ªôt KOC/KOL review s·∫£n ph·∫©m h·∫•p d·∫´n, v√† b·∫°n nh·∫•n n√∫t mua ngay l·∫≠p t·ª©c. Quy·∫øt ƒë·ªãnh mua h√†ng di·ªÖn ra t·ª©c th·ªùi, d·ª±a tr√™n c·∫£m x√∫c, thay v√¨ so s√°nh gi√° c·∫£.</li>
                        </ul>
                    </div>
                </div>
                <div class="content-card" data-type="analysis">
                    <h3>Li√™n h·ªá M√°c-L√™nin</h3>
                    <div class="content-card-body">
                        <ul>
                            <li>Li√™n quan ƒë·∫øn vi·ªác ch·ªß nghƒ©a t∆∞ b·∫£n lu√¥n t√¨m c√°ch **m·ªü r·ªông th·ªã tr∆∞·ªùng v√† t·∫°o ra c√°c "nhu c·∫ßu gi·∫£"**.</li>
                            <li>L√†m **tƒÉng t·ªëc ƒë·ªô l∆∞u th√¥ng c·ªßa t∆∞ b·∫£n (v√≤ng quay t∆∞ b·∫£n)**. H√†ng h√≥a ƒë∆∞·ª£c b√°n nhanh h∆°n, t·ªëi ƒëa h√≥a l·ª£i nhu·∫≠n.</li>
                            <li>L√†m m·ªù ranh gi·ªõi gi·ªØa "th·ªùi gian gi·∫£i tr√≠" v√† "th·ªùi gian ti√™u d√πng", bi·∫øn m·ªçi kho·∫£nh kh·∫Øc th√†nh c∆° h·ªôi ƒë·ªÉ t∆∞ b·∫£n khai th√°c l·ª£i nhu·∫≠n.</li>
                        </ul>
                    </div>
                    <button class="gemini-btn" data-action="explain">‚ú® Gi·∫£i th√≠ch s√¢u h∆°n</button>
                </div>
            </div>
        </section>

    </main>

    <!-- Gemini AI Modal -->
    <div id="gemini-modal" class="hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-amber-800">‚ú® Gi·∫£i th√≠ch s√¢u t·ª´ AI</h3>
                <button id="close-modal-btn" class="text-3xl font-bold text-gray-500 hover:text-gray-800 transition-colors">&times;</button>
            </div>
            <div id="modal-body" class="prose prose-base max-w-none text-gray-800">
                <div class="flex justify-center items-center h-32">
                    <div class="loader"></div>
                </div>
            </div>
            <div class="mt-4 flex gap-4">
                <button id="tts-btn" class="tts-btn" disabled>
                    <span class="tts-icon">üîä</span>
                    <span class="tts-text">Nghe gi·∫£i th√≠ch</span>
                </button>
            </div>
        </div>
    </div>

    <footer class="text-center py-6 mt-8">
        <p class="text-sm text-gray-600">M·ªôt ·ª©ng d·ª•ng web t∆∞∆°ng t√°c d·ª±a tr√™n b√°o c√°o nghi√™n c·ª©u.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const chartData = {
                labels: [
                    'Hi·ªáu ·ª©ng M·∫°ng l∆∞·ªõi', 
                    'C·∫°nh tranh D·ªØ li·ªáu', 
                    'C·∫°nh tranh "ƒê·ªët ti·ªÅn"', 
                    'C·∫°nh tranh H·ªá sinh th√°i', 
                    'Shoppertainment'
                ],
                datasets: [
                    {
                        label: 'Grab',
                        data: [1, 0, 1, 1, 0],
                        backgroundColor: 'rgba(2, 132, 199, 0.7)', // Sky-700
                        stack: 'Stack 0',
                    },
                    {
                        label: 'Shopee',
                        data: [1, 1, 1, 1, 0],
                        backgroundColor: 'rgba(234, 88, 12, 0.7)', // Orange-600
                        stack: 'Stack 0',
                    },
                    {
                        label: 'TikTok Shop',
                        data: [0, 1, 0, 0, 1],
                        backgroundColor: 'rgba(30, 41, 59, 0.7)', // Slate-800
                        stack: 'Stack 0',
                    }
                ]
            };
            
            Chart.defaults.font.family = "'Inter', sans-serif";
            Chart.defaults.font.weight = "500";
            Chart.defaults.color = "#3D3B30";

            const strategyMatrixCtx = document.getElementById('strategyMatrixChart').getContext('2d');
            const strategyMatrixChart = new Chart(strategyMatrixCtx, {
                type: 'bar',
                data: chartData,
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            display: false,
                        },
                        y: {
                            stacked: true,
                            ticks: {
                                font: {
                                    size: 14,
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    size: 14,
                                },
                                usePointStyle: true,
                                boxWidth: 10,
                            }
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleFont: { size: 16, weight: 'bold' },
                            bodyFont: { size: 14 },
                            padding: 12,
                            cornerRadius: 8,
                            callbacks: {
                                title: function(tooltipItems) {
                                    const item = tooltipItems[0];
                                    let label = item.chart.data.labels[item.dataIndex];
                                    if (Array.isArray(label)) {
                                      return label.join(' ');
                                    } else {
                                      return label;
                                    }
                                }
                            }
                        }
                    },
                    onClick: (evt) => {
                        const points = strategyMatrixChart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, true);
                        if (points.length) {
                            const firstPoint = points[0];
                            const label = strategyMatrixChart.data.datasets[firstPoint.datasetIndex].label;
                            if (label) {
                                filterContent(label.toLowerCase().replace(' shop', ''));
                            }
                        }
                    }
                }
            });

            const filterButtons = document.querySelectorAll('.filter-btn');
            const contentWrappers = document.querySelectorAll('.content-wrapper');

            function filterContent(filterValue) {
                filterButtons.forEach(btn => {
                    if (btn.dataset.filter === filterValue) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });

                contentWrappers.forEach(wrapper => {
                    const exampleCard = wrapper.querySelector('[data-company]');
                    const companies = exampleCard ? exampleCard.dataset.company : "";

                    if (filterValue === 'all') {
                        wrapper.classList.remove('dimmed');
                        wrapper.classList.remove('highlight');
                    } else if (companies.includes(filterValue)) {
                        wrapper.classList.remove('dimmed');
                        wrapper.classList.add('highlight');
                    } else {
                        wrapper.classList.add('dimmed');
                        wrapper.classList.remove('highlight');
                    }
                });
            }

            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const filterValue = button.dataset.filter;
                    filterContent(filterValue);
                });
            });

            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('section');
            const navBar = document.getElementById('navbar');

            const observerOptions = {
                rootMargin: `-${navBar.offsetHeight + 50}px 0px 0px 0px`,
                threshold: 0.1
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        navLinks.forEach(link => {
                            link.classList.toggle('active', link.getAttribute('href') === `#${entry.target.id}`);
                        });
                    }
                });
            }, observerOptions);

            sections.forEach(section => {
                observer.observe(section);
            });

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        const topOffset = targetElement.offsetTop - navBar.offsetHeight - 20;
                        window.scrollTo({
                            top: topOffset,
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // --- Gemini AI Feature Logic ---

            const modal = document.getElementById('gemini-modal');
            const modalBody = document.getElementById('modal-body');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const explainBtns = document.querySelectorAll('.gemini-btn[data-action="explain"]');
            const ttsBtn = document.getElementById('tts-btn');
            
            let currentGeneratedText = "";
            let currentAudioPlayer = null;
            let isAudioLoading = false;

            const apiKey = ""; // API key s·∫Ω ƒë∆∞·ª£c cung c·∫•p trong m√¥i tr∆∞·ªùng th·ª±c thi

            function showLoader() {
                modalBody.innerHTML = `<div class="flex justify-center items-center h-32"><div class="loader"></div></div>`;
                modal.classList.remove('hidden');
                ttsBtn.disabled = true;
                currentGeneratedText = "";
            }

            function showModalContent(htmlContent) {
                modalBody.innerHTML = htmlContent;
                modal.classList.remove('hidden');
            }

            function closeModal() {
                modal.classList.add('hidden');
                if (currentAudioPlayer) {
                    currentAudioPlayer.pause();
                    currentAudioPlayer = null;
                }
                resetTTSButton();
            }

            closeModalBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });

            explainBtns.forEach(btn => {
                btn.addEventListener('click', async () => {
                    const wrapper = btn.closest('.content-wrapper');
                    const sectionTitle = wrapper.parentElement.querySelector('h2').textContent.trim();
                    const theoryText = wrapper.querySelector('[data-type="theory"] .content-card-body').textContent.trim();
                    const analysisText = wrapper.querySelector('[data-type="analysis"] .content-card-body').textContent.trim();

                    showLoader();

                    const systemPrompt = `B·∫°n l√† m·ªôt tr·ª£ l√Ω h·ªçc thu·∫≠t chuy√™n v·ªÅ kinh t·∫ø ch√≠nh tr·ªã M√°c-L√™nin v√† kinh t·∫ø s·ªë. Nhi·ªám v·ª• c·ªßa b·∫°n l√† gi·∫£i th√≠ch c√°c kh√°i ni·ªám ph·ª©c t·∫°p m·ªôt c√°ch ƒë∆°n gi·∫£n, r√µ r√†ng cho sinh vi√™n, b·∫±ng ti·∫øng Vi·ªát.`;
                    const userQuery = `D·ª±a tr√™n b·ªëi c·∫£nh sau:
                    Ch·ªß ƒë·ªÅ: "${sectionTitle}"
                    L√Ω thuy·∫øt: "${theoryText}"
                    Li√™n h·ªá M√°c-L√™nin: "${analysisText}"

                    H√£y gi·∫£i th√≠ch s√¢u h∆°n v·ªÅ m·ªëi li√™n h·ªá M√°c-L√™nin n√†y. L√†m r√µ t·∫°i sao bi·ªÉu hi·ªán c·∫°nh tranh trong kinh t·∫ø s·ªë n√†y l·∫°i l√† m·ªôt s·ª± ti·∫øp n·ªëi ho·∫∑c bi·ªÉu hi·ªán m·ªõi c·ªßa c√°c quy lu·∫≠t c·∫°nh tranh v√† ƒë·ªôc quy·ªÅn m√† M√°c v√† L√™nin ƒë√£ ph√¢n t√≠ch. Cung c·∫•p c√¢u tr·∫£ l·ªùi d∆∞·ªõi d·∫°ng c√°c g·∫°ch ƒë·∫ßu d√≤ng s√∫c t√≠ch, d·ªÖ hi·ªÉu.`;

                    try {
                        const result = await callGeminiAPI(systemPrompt, userQuery);
                        currentGeneratedText = result.text; // L∆∞u vƒÉn b·∫£n th√¥
                        const formattedText = result.text.replace(/\* /g, '<li class="ml-4">').replace(/\n/g, '<br>').replace(/<br><li/g, '<li');
                        showModalContent(`<ul class="list-disc space-y-2">${formattedText}</ul>`);
                        ttsBtn.disabled = false; // K√≠ch ho·∫°t n√∫t TTS
                    } catch (error) {
                        showModalContent(`<p class="text-red-600">ƒê√£ x·∫£y ra l·ªói khi g·ªçi AI. Vui l√≤ng th·ª≠ l·∫°i sau.</p><p class="text-sm text-gray-500">${error.message}</p>`);
                    }
                });
            });

            async function callGeminiAPI(systemPrompt, userQuery, retries = 3, delay = 1000) {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && retries > 0) {
                            await new Promise(res => setTimeout(res, delay));
                            return callGeminiAPI(systemPrompt, userQuery, retries - 1, delay * 2);
                        }
                        throw new Error(`API error: ${response.statusText} (status: ${response.status})`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        return { text: candidate.content.parts[0].text };
                    } else {
                        throw new Error("Kh√¥ng nh·∫≠n ƒë∆∞·ª£c n·ªôi dung h·ª£p l·ªá t·ª´ AI.");
                    }
                } catch (error) {
                    console.error("L·ªói g·ªçi Gemini API:", error);
                    throw error;
                }
            }

            // --- Gemini TTS Feature Logic ---
            
            ttsBtn.addEventListener('click', () => {
                if (currentGeneratedText && !isAudioLoading) {
                    if (currentAudioPlayer) {
                        currentAudioPlayer.pause();
                        currentAudioPlayer = null;
                        resetTTSButton();
                    } else {
                        callGeminiTTS(currentGeneratedText);
                    }
                }
            });

            function resetTTSButton(isLoading = false) {
                const icon = ttsBtn.querySelector('.tts-icon');
                const text = ttsBtn.querySelector('.tts-text');
                isAudioLoading = isLoading;
                
                if (isLoading) {
                    icon.innerHTML = `<div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>`;
                    text.textContent = "ƒêang t·∫£i √¢m thanh...";
                    ttsBtn.disabled = true;
                } else {
                    icon.textContent = "üîä";
                    text.textContent = "Nghe gi·∫£i th√≠ch";
                    ttsBtn.disabled = false;
                }
            }
            
            function setTTSButtonPlaying() {
                const icon = ttsBtn.querySelector('.tts-icon');
                const text = ttsBtn.querySelector('.tts-text');
                icon.textContent = "‚ùö‚ùö";
                text.textContent = "D·ª´ng ph√°t";
                ttsBtn.disabled = false;
            }

            async function callGeminiTTS(textToSpeak, retries = 3, delay = 1000) {
                if (isAudioLoading) return;
                resetTTSButton(true);

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{
                        parts: [{ text: `Ph√°t √¢m b·∫±ng gi·ªçng n√≥i ti·∫øng Vi·ªát chu·∫©n, r√µ r√†ng, truy·ªÅn c·∫£m: ${textToSpeak}` }]
                    }],
                    generationConfig: {
                        responseModalities: ["AUDIO"],
                        speechConfig: {
                            voiceConfig: {
                                prebuiltVoiceConfig: { voiceName: "Kore" } 
                            }
                        }
                    },
                    model: "gemini-2.5-flash-preview-tts"
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && retries > 0) {
                            await new Promise(res => setTimeout(res, delay));
                            return callGeminiTTS(textToSpeak, retries - 1, delay * 2);
                        }
                        throw new Error(`TTS API error: ${response.statusText} (status: ${response.status})`);
                    }

                    const result = await response.json();
                    const part = result?.candidates?.[0]?.content?.parts?.[0];
                    const audioData = part?.inlineData?.data;
                    const mimeType = part?.inlineData?.mimeType;

                    if (audioData && mimeType && mimeType.startsWith("audio/")) {
                        const sampleRate = parseInt(mimeType.match(/rate=(\d+)/)?.[1] || "16000", 10);
                        const pcmData = base64ToArrayBuffer(audioData);
                        const pcm16 = new Int16Array(pcmData);
                        const wavBlob = pcmToWav(pcm16, sampleRate);
                        const audioUrl = URL.createObjectURL(wavBlob);
                        
                        currentAudioPlayer = new Audio(audioUrl);
                        currentAudioPlayer.play();
                        setTTSButtonPlaying();
                        
                        currentAudioPlayer.onended = () => {
                            currentAudioPlayer = null;
                            resetTTSButton();
                        };

                    } else {
                        throw new Error("Kh√¥ng nh·∫≠n ƒë∆∞·ª£c d·ªØ li·ªáu √¢m thanh h·ª£p l·ªá.");
                    }
                } catch (error) {
                    console.error("L·ªói g·ªçi Gemini TTS API:", error);
                    resetTTSButton();
                    showModalContent(modalBody.innerHTML + `<p class="text-red-600 text-sm mt-2">L·ªói ph√°t √¢m thanh: ${error.message}</p>`);
                }
            }
            
            function base64ToArrayBuffer(base64) {
                const binaryString = window.atob(base64);
                const len = binaryString.length;
                const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                return bytes.buffer;
            }

            function pcmToWav(pcmData, sampleRate) {
                const numChannels = 1;
                const bitsPerSample = 16;
                const byteRate = sampleRate * numChannels * (bitsPerSample / 8);
                const blockAlign = numChannels * (bitsPerSample / 8);
                const dataSize = pcmData.length * (bitsPerSample / 8);
                const fileSize = 44 + dataSize;
                
                const buffer = new ArrayBuffer(fileSize);
                const view = new DataView(buffer);
                
                function writeString(view, offset, string) {
                    for (let i = 0; i < string.length; i++) {
                        view.setUint8(offset + i, string.charCodeAt(i));
                    }
                }
                
                writeString(view, 0, 'RIFF');
                view.setUint32(4, fileSize - 8, true);
                writeString(view, 8, 'WAVE');
                writeString(view, 12, 'fmt ');
                view.setUint32(16, 16, true);
                view.setUint16(20, 1, true);
                view.setUint16(22, numChannels, true);
                view.setUint32(24, sampleRate, true);
                view.setUint32(28, byteRate, true);
                view.setUint16(32, blockAlign, true);
                view.setUint16(34, bitsPerSample, true);
                writeString(view, 36, 'data');
                view.setUint32(40, dataSize, true);
                
                for (let i = 0; i < pcmData.length; i++) {
                    view.setInt16(44 + i * 2, pcmData[i], true);
                }
                
                return new Blob([view], { type: 'audio/wav' });
            }
            
        });
    </script>
</body>
</html>

